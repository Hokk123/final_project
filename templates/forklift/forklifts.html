{% extends '../default.html' %}
{% csrf_token %}
{% load static %}

{% block title %}
Forklifts
{% endblock title %}
 
{% block content %}
    <link href="{% static 'css/forklifts.css'%}" rel="stylesheet" />
    <div class="div-yellow">
        {% if user.is_authenticated %}
            {% if user_in_group_manager or user.is_superuser %}
                <p class="title"> {{ user.username }}</p>
            {% elif user_in_group_service_company %}
                <p class="title"> {{ forklift.0.service_company.title }}</p>
            {% else %}
                <p class="title"> {{ forklift.0.client.title }} </p>
            {% endif %}
            <div class="button">
                <button id="filter-button" class="button">Фильтр</button>
                <div id = "filter-block" class = "hidden">
                    {# Добавляем форму, которая объединяет набор полей, которые будут отправляться в запросе #}
                    <form action="" method="get" class="form-login">
                        {{filterset.form.non_field_errors}}
                        {{filterset.form.model_equipment__title__icontains.errors }}
                        <label for="{{filterset.form.model_equipment__title__icontains.id_for_label}}" class="label-login">Модель техники</label>
                        <input 
                            id="{{filterset.form.model_equipment__title__icontains.id}}"
                            name="{{filterset.form.model_equipment__title__icontains.name}}"
                            value="{{filterset.form.model_equipment__title__icontains.id}}"
                            class="form-login-in"
                        >

                        {{filterset.form.engine_model__title__icontains.errors }}
                        <label for="{{filterset.form.engine_model__title__icontains.id_for_label}}"class="label-login">Модель двигателя</label>
                        <input 
                            id="{{filterset.form.engine_model__title__icontains.id}}"
                            name="{{filterset.form.engine_model__title__icontains.name}}"
                            value="{{filterset.form.engine_model__title__icontains.id}}"
                            class="form-login-in"
                        >

                        {{filterset.form.transmission_model__title__icontains.errors }}
                        <label for="{{filterset.form.transmission_model__title__icontains.id_for_label}}" class="label-login">Модель трансмиссии</label>
                        <input 
                            id="{{filterset.form.transmission_model__title__icontains.id}}"
                            name="{{filterset.form.transmission_model__title__icontains.name}}"
                            value="{{filterset.form.transmission_model__title__icontains.id}}"
                            class="form-login-in"
                        >

                        {{filterset.form.drive_axle_model__title__icontains.errors }}
                        <label for="{{filterset.form.drive_axle_model__title__icontains.id_for_label}}" class="label-login">Модель ведущего моста</label>
                        <input 
                            id="{{filterset.form.drive_axle_model__title__icontains.id}}"
                            name="{{filterset.form.drive_axle_model__title__icontains.name}}"
                            value="{{filterset.form.drive_axle_model__title__icontains.id}}"
                            class="form-login-in"
                        >

                        {{filterset.form.controlled_bridge_model__title__icontains.errors }}
                        <label for="{{filterset.form.controlled_bridge_model__title__icontains.id_for_label}}" class="label-login">Модель управляемого моста</label>
                        <input 
                            id="{{filterset.form.controlled_bridge_model__title__icontains.id}}"
                            name="{{filterset.form.controlled_bridge_model__title__icontains.name}}"
                            value="{{filterset.form.controlled_bridge_model__title__icontains.id}}"
                            class="form-login-in"
                        >
                        <div class="button">
                            <input type="submit" class="button" value="Найти" />
                        </div>
                    </form>
                </div>
            </div>
        {% else %}
            <h3 class="title">Проверьте комплектацию и технические характеристики техники Силант</h3>
            <form class="form-control" action="" method="get">
                {{filterset.form.non_field_errors}}
                {{filterset.form.machine_serial_number__icontains.errors }}
                <input
                    id="{{filterset.form.machine_serial_number__icontains.id}}"
                    name="{{filterset.form.machine_serial_number__icontains.name}}"
                    value="{{filterset.form.machine_serial_number__icontains.id}}"
                    class="form-control"
                    placeholder="Заводской номер"
                >
                <input type="submit" class="form-button"  value="Найти">
            </form>
        {% endif %}
    </div>
    <div id="table-container" class="div-white">
        <h5 id = "table_header_1" style="display:block;" class="login-title">Информация о комплектации и технических характеристиках Вашей техники</h5>
        <table id = "table1" class="common-table">
            {% if forklifts %}
            <thead>
            <tr>
                <th> Зав. № машины </th>
                <th> Модель техники </th>
                <th> Модель двигателя </th>
                <th> Зав. № двигателя </th>
                <th> Модель трансмиссии </th>
                <th> Зав. № трансмиссии </th>
                <th> Модель ведущего моста </th>
                <th> Зав. № ведущего моста </th>
                <th> Модель управляемого моста </th>
                <th> Зав. № управляемого моста </th>
                {% if user.is_authenticated %}
                    <th> Договор доставки №, дата </th>
                    <th> Дата отгрузки с завода </th>
                    <th> Грузополучатель (конечный потребитель) </th>
                    <th> Адрес поставки (эксплуатации) </th>
                    <th> Комплектация (доп. опции) </th>
                    <th> Клиент </th>
                    <th> Сервисная компания </th>
                {% endif %}
            </tr>
            </thead>


            <tbody>
            {% for forklift in forklifts %}
            <tr>
                    {% if user.is_authenticated %}
                        <td><a href="{% url 'forklift_detail' forklift.pk %}">{{ forklift.machine_serial_number }}</a></td>
                        <td><a href="{% url 'model_equipment_detail' forklift.model_equipment.pk %}">{{ forklift.model_equipment.title }}</a></td>
                        <td><a href="{% url 'engine_model_detail' forklift.engine_model.pk %}">{{ forklift.engine_model.title }}</a></td>
                        <td>{{ forklift.engine_serial_number }}</td>
                        <td><a href="{% url 'transmission_model_detail' forklift.transmission_model.pk %}">{{ forklift.transmission_model.title }}</a></td>
                        <td>{{ forklift.transmission_serial_number }}</td>
                        <td><a href="{% url 'drive_axle_model_detail' forklift.drive_axle_model.pk %}">{{ forklift.drive_axle_model.title }}</a></td>
                        <td>{{ forklift.drive_axle_serial_number }}</td>
                        <td><a href="{% url 'controlled_bridge_model_detail' forklift.controlled_bridge_model.pk %}">{{ forklift.controlled_bridge_model.title }}</a></td>
                        <td>{{ forklift.controlled_bridge_serial_number }}</td>
                        <td>{{ forklift.supply_contract }}</td>
                        <td>{{ forklift.date_of_shipment }}</td>
                        <td>{{ forklift.end_user }}</td>
                        <td>{{ forklift.delivery_address|truncatechars:20 }}</td>
                        <td>{{ forklift.equipment|truncatewords:6 }}</td>
                        <td><a href="{% url 'client_detail' forklift.client.pk %}">{{ forklift.client.title }}</a></td>
                        <td><a href="{% url 'service_company_detail' forklift.service_company.pk %}">{{ forklift.service_company.title }}</a></td>
                    {% else %}
                        <td>{{ forklift.machine_serial_number }}</td>
                        <td>{{ forklift.model_equipment.title }}</td>
                        <td>{{ forklift.engine_model.title }}</td>
                        <td>{{ forklift.engine_serial_number }}</td>
                        <td>{{ forklift.transmission_model.title }}</td>
                        <td>{{ forklift.transmission_serial_number }}</td>
                        <td>{{ forklift.drive_axle_model.title }}</td>
                        <td>{{ forklift.drive_axle_serial_number }}</td>
                        <td>{{ forklift.controlled_bridge_model.title }}</td>
                        <td>{{ forklift.controlled_bridge_serial_number }}</td>
                    {% endif %}
            </tr>
            {% endfor %}
            </tbody>
            {% else %}
                {% if page_obj.number == 1 %}
                    <tr>
                        <td colspan="17">Машин нет!</td>
                    </tr>
                {% endif %}
            {% endif %}
        </table> 

        <table id = "table2" class="common-table">
        <h2 id="table_header_2" style="display:none;" class="login-title">Информация о проведенных ТО Вашей техники</h2>
        {% if tos %}
            <thead>
                <tr>
                    <th> № </th>
                    <th> Вид ТО </th>
                    <th> Дата проведения ТО </th>
                    <th> Наработка, м/час </td>
                    <th> № заказ-наряда </th>
                    <th> дата заказ-наряда </th>
                    <th> Организация, проводившая ТО </th>
                    <th> зав. N. машины </th>
                    <th> сервисная компания </th>
                </tr>
            </thead>
            <tbody>
            {% for to in tos %}
                <tr>
                    <td><a href="{% url 'to_detail' to.pk %}">{{ forloop.counter }}</a></td>
                    <td><a href="{% url 'type_of_to_detail' to.type.pk %}">{{ to.type.title }}</a></td>
                    <td>{{ to.date }}</td>
                    <td>{{ to.operating }}</td>
                    <td>{{ to.orders_number }}</td>
                    <td>{{ to.orders_date }}</td>
                    <td>{{ to.organization }}</td>
                    <td><a href="{% url 'forklift_detail' to.forklift.pk %}">{{ to.forklift.machine_serial_number }}</a></td>
                    <td><a href="{% url 'service_company_detail' to.service_company.pk %}">{{ to.service_company.title }}</a></td>
                </tr>
            {% endfor %}
            </tbody>
        {% else %}
                {% if page_obj.number == 1 %}
                    <tr>
                        <td colspan="8">ТО не найдено!</td>
                    </tr>
                {% endif %}
        {% endif %}
        </table>

        <table id = "table3" class="common-table">
        <h5 id="table_header_3" style="display:none;" class="login-title">Информация о рекламациях Вашей техники</h5>
        {% if claims %}
        <tr>
            <th> № </th>
            <th> Дата отказа </th>
            <th> Наработка, м/час </th>
            <th> Узел отказа </th>
            <th> Описание отказа </th>
            <th> Способ восстановления </th>
            <th> Используемые запасные части </th>
            <th> Дата восстановления </th>
            <th> Время простоя техники </th>
            <th> машина </th>
            <th> сервисная компания </th>
        </tr>

        {% for claim in claims %}
        <tr>
            <td><a href="{% url 'claim_detail' claim.pk %}">{{ forloop.counter }}</a></td>
            <td>{{ claim.orders_date }}</td>
            <td>{{ claim.operating }}</td>
            <td><a href="{% url 'nature_of_failure_detail' claim.order_note.pk %}">{{ claim.order_note.title }}</a></td>
            <td>{{ claim.order_description }}</td>
            <td><a href="{% url 'recovery_method_detail' claim.recovery_method.pk %}">{{ claim.recovery_method.title }}</a></td>
            <td>{{ claim.used_spare_parts }}</td>
            <td>{{ claim.recovery_date }}</td>
            <td>{{ claim.downtime }}</td>
            <td><a href="{% url 'forklift_detail' claim.forklift.pk %}">{{ claim.forklift.machine_serial_number }}</a></td>
            <td><a href="{% url 'service_company_detail' claim.service_company.pk %}">{{ claim.service_company.title }}</a></td>
        </tr>
        {% endfor %}
        {% else %}
            {% if page_obj.number == 1 %}
                <tr>
                    <td colspan="10">Рекламаций нет!</td>
                </tr>
            {% endif %}
        {% endif %}
        </table>
    </div>
    {% block extra_js %}
        <script src="{% static 'scripts/hokkscript.js' %}"></script>
    {% endblock %}
{% endblock content %}